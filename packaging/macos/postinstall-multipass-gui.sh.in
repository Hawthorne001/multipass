#!/bin/bash
set -e

bundle_path="${3}@CPACK_PACKAGING_INSTALL_PREFIX@/bin/multipass.gui.app/Contents"
thebin="multipass.gui"
binpath="${bundle_path}/MacOS/${thebin}"

rm -fv "${3}usr/local/bin/${thebin}"  # this may have been leftover by earlier uninstalls

mkdir -p "${bundle_path}/plugins"
ln -fsv "${3}@CPACK_PACKAGING_INSTALL_PREFIX@/bin/platforms/" "${bundle_path}/plugins/platforms"

# Create app
appcontents="${3}/Applications/Multipass.app/Contents"
mkdir -p ${appcontents}/{MacOS,Resources,plugins}
ln -fsv "${binpath}" "${appcontents}/MacOS/Multipass"
ln -fsv "${3}@CPACK_PACKAGING_INSTALL_PREFIX@/Resources/Info.plist" "${appcontents}"
ln -fsv "${3}@CPACK_PACKAGING_INSTALL_PREFIX@/Resources/icon.icns" "${appcontents}/Resources"
ln -fsv "${3}@CPACK_PACKAGING_INSTALL_PREFIX@/bin/platforms/" "${appcontents}/plugins/platforms"

echo 0
